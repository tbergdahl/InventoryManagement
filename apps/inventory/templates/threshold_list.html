<!-- threshold_list.html -->
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Threshold Management</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      background-color: #e7ebf1;
    }
    .container {
      max-width: 1000px;
      margin: 40px auto;
      padding: 20px;
      background: #90cfc4;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(75, 49, 49, 0.06);
    }
    .title {
      text-align: center;
      margin-bottom: 30px;
      font-weight: 600;
      color: #4074a9;
    }
    .action-icons a {
      margin: 0 5px;
      color: #3a5f83;
      font-size: 16px;
    }
    .color-box {
      width: 25px;
      height: 20px;
      border-radius: 4px;
      border: 1px solid #e9eae7;
      display: inline-block;
    }
    .modal-content {
      padding: 20px;
    }
    .add-btn {
      position: absolute;
      right: 40px;
      top: 20px;
      font-size: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2 class="title">Manage Thresholds</h2>
    <a href="#" class="btn btn-success add-btn" data-bs-toggle="modal" data-bs-target="#addModal"><i class="fas fa-plus"></i></a>

    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Product</th>
          <th>Min Qty</th>
          <th>Max Qty</th>
          <th>Color</th>
          <th>Message</th>
          <th>Created Date</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for t in thresholds %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ t.product }}</td>
          <td>{{ t.min_quantity }}</td>
          <td>{{ t.max_quantity }}</td>
          <td><div class="color-box" style="background-color: '{{ t.color }}';"></div></td>
          <td>{{ t.template_message }}</td>
          <td>{{ t.created_at|date:"d/m/Y" }}</td>
          <td class="action-icons">
            <a href="#" data-bs-toggle="modal" data-bs-target="#viewModal-{{ t.id }}"><i class="fas fa-eye"></i></a>
            <a href="#" title="Edit" data-bs-toggle="modal" data-bs-target="#editModal-{{ t.id }}"><i class="fas fa-pen"></i></a>
            <a href="#" data-bs-toggle="modal" data-bs-target="#deleteModal-{{ t.id }}"><i class="fas fa-trash-alt text-danger"></i></a>
          </td>
        </tr>

<!-- View Modal -->
<div class="modal fade" id="viewModal-{{ t.id }}" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Threshold Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p><strong>Product:</strong> {{ t.product }}</p>
        <p><strong>Min Qty:</strong> {{ t.min_quantity }}</p>
        <p><strong>Max Qty:</strong> {{ t.max_quantity }}</p>
        <p><strong>Message:</strong> {{ t.template_message }}</p>
        <p><strong>Color:</strong> <span style="display:inline-block;width:20px;height:20px;background-color:'{{ t.color }}';"></span></p>
        <p><strong>Created Date:</strong> {{ t.created_at|date:"d/m/Y" }}</p>
      </div>
    </div>
  </div>
</div>

<!-- Edit Modal -->
<div class="modal fade" id="editModal-{{ t.id }}" tabindex="-1" aria-labelledby="editModalLabel-{{ t.id }}" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <form method="POST" action="{% url 'edit_threshold' t.id %}">
        {% csrf_token %}

        <div class="modal-header">
          <h5 class="modal-title" id="editModalLabel-{{ t.id }}">
            <i class="fas fa-pen me-2 text-primary"></i> Edit Threshold
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <div class="mb-3">
            <label for="minQty-{{ t.id }}" class="form-label">Min Quantity</label>
            <input type="number" name="min_quantity" id="minQty-{{ t.id }}" class="form-control" value="{{ t.min_quantity }}" required>
          </div>

          <div class="mb-3">
            <label for="maxQty-{{ t.id }}" class="form-label">Max Quantity</label>
            <input type="number" name="max_quantity" id="maxQty-{{ t.id }}" class="form-control" value="{{ t.max_quantity }}" required>
          </div>

          <div class="mb-3">
            <label for="color-{{ t.id }}" class="form-label">Color</label>
            <input type="color" name="color" id="color-{{ t.id }}" class="form-control form-control-color" value="{{ t.color }}">
          </div>

          <div class="mb-3">
            <label for="message-{{ t.id }}" class="form-label">Message Template</label>
            <input type="text" name="template_message" id="message-{{ t.id }}" class="form-control" value="{{ t.template_message }}">
          </div>
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save me-1"></i> Save
          </button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="fas fa-times me-1"></i> Cancel
          </button>
        </div>
      </form>

    </div>
  </div>
</div>


<!-- Delete Modal -->
<div class="modal fade" id="deleteModal-{{ t.id }}" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-body text-center">
        <p>Are you sure you want to delete <strong>{{ t.product }}</strong>?</p>
        <a href="{% url 'delete_threshold' t.id %}" class="btn btn-danger btn-sm">Yes, Delete</a>
        <button class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>


<!-- Add Threshold Modal -->
<div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <form method="POST" action="{% url 'add_threshold' %}">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title" id="addModalLabel">
            <i class="fas fa-plus-circle me-2 text-success"></i> Add New Threshold
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Product</label>
            <input type="text" name="product" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Min Quantity</label>
            <input type="number" name="min_quantity" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Max Quantity</label>
            <input type="number" name="max_quantity" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Color</label>
            <input type="color" name="color" class="form-control form-control-color">
          </div>
          <div class="mb-3">
            <label class="form-label">Message Template</label>
            <input type="text" name="template_message" class="form-control">
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">
            <i class="fas fa-plus me-1"></i> Add
          </button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
